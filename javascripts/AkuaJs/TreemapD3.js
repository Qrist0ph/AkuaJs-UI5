define(["core/CoreBundle","nv.d3.min"],function(){function d(a){Apple.call(this,a);this.axis0=a.axis0;this.size=a.pkm0?a.pkm0:T([]);this.color=a.pkm1?a.pkm1:T([]);this.divid=guid();this.height=a.height?a.height:400;this.numberFormat=a.numberFormat?a.numberFormat:[2,",",".",""]}d.prototype=new Apple;d.prototype.constructor=d;d.prototype.getView=function(){CssClassDefined("node")||$("head").append('<style type="text/css">.node {border: solid 1px white;font: 10px sans-serif;line-height: 12px;overflow: hidden;position: absolute;text-indent: 2px;}.TreeTooltip {position: absolute;border:1px solid;margin:10px;padding: 6px;opacity: 0.9;z-index: 1000;}</style>');
return this.view=$('<div id="'+this.divid+'"></div>')};d.prototype.updateValues=function(){var a=this,e=$("#"+a.divid).parent().parent().width(),b=a.height;a.chart=d3.layout.treemap().size([e,b]).value(function(a){return a.size});$("#"+a.divid).empty();var e=d3.select("#"+a.divid).style("position","relative").style("width",e+0+0+"px").style("height",b+0+0+"px").style("left","0px").style("top","0px"),c=d3.select("body").append("div").attr("class","TreeTooltip").style("visibility","hidden").style("background-color",
"#ffffff");e.datum(a.testdata()).selectAll(".node").data(a.chart.nodes).enter().append("div").attr("class","node").call(function(){this.style("left",function(a){return a.x+"px"}).style("top",function(a){return a.y+"px"}).style("width",function(a){return Math.max(0,a.dx-1)+"px"}).style("height",function(a){return Math.max(0,a.dy-1)+"px"})}).style("background",function(a){return a.color?a.color:null}).text(function(a){return a.children?null:a.name}).on("mouseover",function(b){b.size&&(c.html(b.name+
" Value "+b.size.formatNumber(a.numberFormat)+" Gewinn:"+b.pkm1.formatNumber(a.numberFormat)),c.style("visibility","visible"),this.style.cursor="hand")}).on("mousemove",function(){c.style("top",d3.event.pageY+"px").style("left",d3.event.pageX+"px")}).on("mouseout",function(){c.style("visibility","hidden")}).on("click",function(a){a.size&&(window.location.href="/AssetDetails/Index/"+a.wkn)})};d.prototype.testdata=function(){for(var a=this.axis0.Tuples().ToArray(),e=-Infinity,b=0;b<a.length;b++)var c=
Math.abs(this.getValue(a[b].And(this.color))),e=c>e?c:e;for(var d=[],b=0;b<a.length;b++){var f=this.getValue(a[b].And(this.color)),c=f/e,c=0>c?ColorLuminance("FF0000",1+c):ColorLuminance("00FF00",1-c);d.push({name:a[b].ToCaption().split("#")[1],size:this.getValue(a[b].And(this.size)),color:c,pkm1:f,wkn:a[b].ToCaption().split("#")[0]})}return{name:"flare",children:d}};d.prototype.selectionCallback=function(){str="";this.getSelection().each(function(){str+=$(this).text()+" "});alert(str)};return function(a){return new d.prototype.constructor(a)}});
